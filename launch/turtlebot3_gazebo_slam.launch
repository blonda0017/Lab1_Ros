<launch>
  <!-- Arguments -->
  <arg name="model" default="waffle" doc="model type [burger, waffle, waffle_pi]"/>
  <arg name="rviz" default="true"/>
  <arg name="rviz_config" default="$(find super_blonda_study_pkg)/rviz/autonomous_navigation.rviz"/>
  <arg name="move_forward_only" default="false"/>

  <!-- 1. Запуск симуляции через turtlebot3_sim_start.launch -->
  <include file="$(find super_blonda_study_pkg)/launch/turtlebot3_sim_start.launch">
    <arg name="model" value="$(arg model)" />
    <arg name="rviz" value="false" />
  </include>

  <!-- 2. Запуск SLAM gmapping -->
  <include file="$(find super_blonda_study_pkg)/launch/turtlebot3_my_gmapping.launch">
    <arg name="model" value="$(arg model)" />
  </include>

  <!-- 3. Запуск move_base для автономной навигации -->
  <include file="$(find super_blonda_study_pkg)/launch/move_base.launch">
    <arg name="model" value="$(arg model)" />
    <arg name="move_forward_only" value="$(arg move_forward_only)" />
  </include>

  <!-- 4. Запуск RViz с конфигурацией для автономной навигации -->
  <group if="$(arg rviz)">
    <node pkg="rviz" type="rviz" name="rviz" required="true"
          args="-d $(arg rviz_config)"/>
  </group>

  <!-- 5. Дополнительно: информация для пользователя -->
  <node pkg="rostopic" type="rostopic" name="initial_pose_pub" 
        args="pub -1 /initialpose geometry_msgs/PoseWithCovarianceStamped '{ header: { frame_id: map }, pose: { pose: { position: { x: 0.0, y: 0.0, z: 0.0 }, orientation: { x: 0.0, y: 0.0, z: 0.0, w: 1.0 } } } }'"
        output="screen"/>
</launch>
