<launch>
    <!-- Аргументы -->
    <arg name="model" default="waffle"/>
    
    <!-- Установка модели -->
    <env name="TURTLEBOT3_MODEL" value="$(arg model)" />
    
    <!-- 1. Запуск симуляции -->
    <include file="$(find turtlebot3_gazebo)/launch/turtlebot3_world.launch">
        <arg name="model" value="$(arg model)" />
    </include>

    <!-- 2. Запуск SLAM -->
    <include file="$(find turtlebot3_slam)/launch/turtlebot3_slam.launch">
        <arg name="slam_methods" value="gmapping"/>
    </include>

    <!-- 3. ЯВНО включаем публикацию costmap через параметры -->
    <rosparam>
        /move_base/global_costmap/publish_frequency: 1.0
        /move_base/local_costmap/publish_frequency: 1.0  
        /move_base/global_costmap/always_send_full_costmap: true
        /move_base/local_costmap/always_send_full_costmap: true
    </rosparam>

    <!-- 4. Запуск навигации БЕЗ отсутствующих параметров -->
    <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
        <param name="base_global_planner" value="navfn/NavfnROS"/>
        <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS"/>
        
        <!-- Загружаем ТОЛЬКО существующие параметры -->
        <rosparam file="$(find turtlebot3_navigation)/param/costmap_common_params_$(arg model).yaml" command="load" ns="global_costmap" />
        <rosparam file="$(find turtlebot3_navigation)/param/costmap_common_params_$(arg model).yaml" command="load" ns="local_costmap" />
        <rosparam file="$(find turtlebot3_navigation)/param/local_costmap_params.yaml" command="load" />
        <rosparam file="$(find turtlebot3_navigation)/param/global_costmap_params.yaml" command="load" />
        <rosparam file="$(find turtlebot3_navigation)/param/move_base_params.yaml" command="load" />
        <rosparam file="$(find turtlebot3_navigation)/param/dwa_local_planner_params_$(arg model).yaml" command="load" />
        
        <!-- УБИРАЕМ строку с global_planner_params.yaml -->
    </node>

    <!-- 5. Запуск RViz -->
    <node pkg="rviz" type="rviz" name="rviz" required="true"
          args="-d $(find turtlebot3_navigation)/rviz/turtlebot3_navigation.rviz"/>
</launch>
